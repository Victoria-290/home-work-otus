package service

import (
	"fmt"
	"math/rand"
	"strconv"
	"time"

	"github.com/Victoria-290/home-work-otus/Progect/internal/model/auth"
	"github.com/Victoria-290/home-work-otus/Progect/internal/model/task"
	"github.com/Victoria-290/home-work-otus/Progect/internal/model/user"
	"github.com/Victoria-290/home-work-otus/Progect/internal/repository"
)

var emailCounter = 1
var taskCounter = 1

// GenerateAndStoreEntities создает и сохраняет сущности
func GenerateAndStoreEntities() {
	rand.Seed(time.Now().UnixNano())

	// Создаем пользователя
	email := "user" + strconv.Itoa(emailCounter) + "@test.com"
	u := user.NewUser(email, "pass123")
	u.ID = int64(emailCounter)
	emailCounter++

	// Создаем задачу
	title := "Task #" + strconv.Itoa(taskCounter)
	t := task.NewTask(title, "Generated by scheduler", u.ID)
	t.ID = int64(taskCounter)
	taskCounter++

	// Создаем токен
	token := &auth.Token{
		UserID:    u.ID,
		Token:     fmt.Sprintf("token-%d", rand.Intn(1000000)),
		ExpiresAt: time.Now().Add(time.Hour),
		IsRefresh: false,
	}

	// Передаем в репозиторий
	repository.Store(u)
	repository.Store(t)
	repository.Store(token)
}
